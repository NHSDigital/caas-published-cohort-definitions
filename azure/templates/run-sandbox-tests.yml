steps:
    - template: "azure/components/aws-assume-role.yml@common"
      parameters:
          role: "auto-ops"
          profile: "apm_ptl"

    - template: "azure/components/get-aws-secrets-and-ssm-params.yml@common"
      parameters:
          secret_ids:
              - ptl/api-deployment/caas-published-cohort-definitions/INTEGRATION_API_KEY

    - bash: |
          make install-node
      workingDirectory: $(Pipeline.Workspace)/s/$(SERVICE_NAME)/$(SERVICE_ARTIFACT_NAME)
      displayName: Setup postman-tests
      condition: always()

    - bash: |
          npm run postman-test
      workingDirectory: $(Pipeline.Workspace)/s/$(SERVICE_NAME)/$(SERVICE_ARTIFACT_NAME)
      displayName: Run postman-tests
